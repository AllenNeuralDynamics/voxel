# Hybrid configuration - local devices + remote cameras
# DAQ, lasers, axes run locally; cameras run on separate nodes
_anchors:
  - &camera_ip "127.0.0.1"
  - &camera_target spim_drivers.cameras.simulated.SimulatedCamera
  - &sim_pixel_size_um "3.76,3.76"
  - &sim_camera_sensor_px "10640,14192"
  - &laser_target spim_drivers.lasers.simulated.SimulatedLaser
  - &aotf_laser_target spim_drivers.lasers.simulated.SimulatedAOTFShutteredLaser
  - &aotf_target spim_drivers.aotf.simulated.SimulatedAotf
  - &daq_target spim_drivers.daqs.simulated.SimulatedDaq
  - &fw_target spim_drivers.axes.simulated.SimulatedDiscreteAxis
  - &linear_axis_target spim_drivers.axes.simulated.SimulatedContinuousAxis
  - &default_timing
    sample_rate: "100 kHz"
    duration: "0.2 s"
    rest_time: "0.05 s"
  - &camera_waveform_ch1
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.0, max: 0.95 }
  - &camera_waveform_ch2
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.02, max: 0.97 }
  - &laser_waveform_ch1
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.1, max: 0.9 }
  - &laser_waveform_ch2
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.12, max: 0.92 }
  - &aotf_blanking_waveform
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.05, max: 0.95 }

info:
  name: "HybridSimulatedRig"

cluster:
  control_port: 9000

# Local devices - no ZMQ overhead for these
devices:
  daq_1:
    target: *daq_target
    init: { device_name: "MockDev1" }
  aotf_1:
    target: *aotf_target
    init: { blanking_mode: "external" }
  laser_488:
    target: *aotf_laser_target
    init:
      wavelength: 488
      aotf: aotf_1
      aotf_channel: 1
      aotf_frequency_mhz: 98.2
  laser_561:
    target: *aotf_laser_target
    init:
      wavelength: 561
      aotf: aotf_1
      aotf_channel: 2
      aotf_frequency_mhz: 87.4
  fw_detection:
    target: *fw_target
    init:
      slots: { 0: "Quad-DGRC", 1: "Dual-DR" }
  fw_emission_cam1:
    target: *fw_target
    init:
      slots: { 0: "BP525", 1: "BP600" }
  fw_emission_cam2:
    target: *fw_target
    init:
      slots: { 0: "BP525", 1: "BP600" }
  x_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 36.7 }
  y_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 23.0 }
  z_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 50.0 }

# Remote devices - cameras on separate nodes (require ZMQ)
nodes:
  camera_node_1:
    hostname: *camera_ip
    devices:
      camera_1:
        target: *camera_target
        init:
          pixel_size_um: *sim_pixel_size_um
          sensor_size_px: *sim_camera_sensor_px
  camera_node_2:
    hostname: *camera_ip
    devices:
      camera_2:
        target: *camera_target
        init:
          pixel_size_um: *sim_pixel_size_um
          sensor_size_px: *sim_camera_sensor_px

globals:
  default_overlap: 0.1
  default_tile_order: snake_row

stage:
  x: x_axis
  y: y_axis
  z: z_axis

daq:
  device: daq_1
  acq_ports:
    laser_488: ao0
    laser_561: ao1
    camera_1: ao2
    camera_2: ao3
    aotf_1: ao4

detection:
  camera_1:
    filter_wheels: [fw_detection, fw_emission_cam1]
    magnification: 8.0
  camera_2:
    filter_wheels: [fw_detection, fw_emission_cam2]
    magnification: 8.0

illumination:
  laser_488: {}
  laser_561: {}

channels:
  gfp_cam1:
    detection: camera_1
    illumination: laser_488
    filters:
      fw_detection: "Quad-DGRC"
      fw_emission_cam1: "BP525"
    desc: "GFP on camera 1"
    label: GFP-1
    emission: 510
  gfp_cam2:
    detection: camera_2
    illumination: laser_488
    filters:
      fw_detection: "Quad-DGRC"
      fw_emission_cam2: "BP525"
    desc: "GFP on camera 2"
    label: GFP-2
    emission: 510
  rfp_cam1:
    detection: camera_1
    illumination: laser_561
    filters:
      fw_detection: "Quad-DGRC"
      fw_emission_cam1: "BP600"
    desc: "RFP on camera 1"
    label: RFP-1
    emission: 600
  rfp_cam2:
    detection: camera_2
    illumination: laser_561
    filters:
      fw_detection: "Quad-DGRC"
      fw_emission_cam2: "BP600"
    desc: "RFP on camera 2"
    label: RFP-2
    emission: 600

profiles:
  dual_gfp:
    channels: ["gfp_cam1", "gfp_cam2"]
    daq:
      timing: *default_timing
      waveforms:
        camera_1: *camera_waveform_ch1
        camera_2: *camera_waveform_ch2
        laser_488: *laser_waveform_ch1
        aotf_1: *aotf_blanking_waveform
    desc: "Dual camera GFP imaging"
  dual_rfp:
    channels: ["rfp_cam1", "rfp_cam2"]
    daq:
      timing: *default_timing
      waveforms:
        camera_1: *camera_waveform_ch1
        camera_2: *camera_waveform_ch2
        laser_561: *laser_waveform_ch1
        aotf_1: *aotf_blanking_waveform
    desc: "Dual camera RFP imaging"
  single_gfp:
    channels: ["gfp_cam1"]
    daq:
      timing: *default_timing
      waveforms:
        camera_1: *camera_waveform_ch1
        laser_488: *laser_waveform_ch1
        aotf_1: *aotf_blanking_waveform
    desc: "Single camera GFP"
