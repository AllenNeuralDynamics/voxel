# Local-only configuration - all devices run in the main process (no ZMQ)
_anchors:
  - &camera_target spim_drivers.cameras.simulated.SimulatedCamera
  - &sim_pixel_size_um "0.5,0.5"
  - &sim_camera_sensor_px "2660,3548" # Smaller for local testing
  - &laser_target spim_drivers.lasers.simulated.SimulatedLaser
  - &aotf_laser_target spim_drivers.lasers.simulated.SimulatedAOTFShutteredLaser
  - &aotf_target spim_drivers.aotf.simulated.SimulatedAotf
  - &daq_target spim_drivers.daqs.simulated.SimulatedDaq
  - &fw_target spim_drivers.axes.simulated.SimulatedDiscreteAxis
  - &linear_axis_target spim_drivers.axes.simulated.SimulatedContinuousAxis
  - &default_timing
    sample_rate: "100 kHz"
    duration: "0.2 s"
    rest_time: "0.05 s"
  - &camera_waveform
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.0, max: 0.95 }
  - &laser_waveform
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.1, max: 0.9 }
  - &aotf_blanking_waveform
    type: pulse
    voltage: { min: 0.0, max: 5.0 }
    window: { min: 0.05, max: 0.95 }

info:
  name: "LocalSimulatedRig"

cluster:
  control_port: 9000

# All devices defined at top level = local mode (no ZMQ overhead)
devices:
  daq_1:
    target: *daq_target
    init: { device_name: "MockDev1" }
  camera_1:
    target: *camera_target
    init:
      pixel_size_um: *sim_pixel_size_um
      sensor_size_px: *sim_camera_sensor_px
  aotf_1:
    target: *aotf_target
    init: { blanking_mode: "external" }
  laser_488:
    target: *aotf_laser_target
    init:
      wavelength: 488
      aotf: aotf_1
      aotf_channel: 1
      aotf_frequency_mhz: 98.2
  laser_561:
    target: *aotf_laser_target
    init:
      wavelength: 561
      aotf: aotf_1
      aotf_channel: 2
      aotf_frequency_mhz: 87.4
  fw_emission:
    target: *fw_target
    init:
      slots: { 0: "BP525", 1: "BP600", 2: "BP700" }
  x_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 40.0 }
  y_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 25.0 }
  z_axis:
    target: *linear_axis_target
    init: { lower_limit: 0.0, upper_limit: 50.0 }

globals:
  default_overlap: 0.1
  default_tile_order: snake_row

stage:
  x: x_axis
  y: y_axis
  z: z_axis

daq:
  device: daq_1
  acq_ports:
    laser_488: ao0
    laser_561: ao1
    camera_1: ao2
    aotf_1: ao3

detection:
  camera_1:
    filter_wheels: [fw_emission]
    magnification: 10.0

illumination:
  laser_488: {}
  laser_561: {}

channels:
  gfp:
    detection: camera_1
    illumination: laser_488
    filters:
      fw_emission: "BP525"
    desc: "GFP channel"
    label: GFP
    emission: 510
  rfp:
    detection: camera_1
    illumination: laser_561
    filters:
      fw_emission: "BP600"
    desc: "RFP channel"
    label: RFP
    emission: 600

profiles:
  single_gfp:
    channels: ["gfp"]
    daq:
      timing: *default_timing
      waveforms:
        camera_1: *camera_waveform
        laser_488: *laser_waveform
        aotf_1: *aotf_blanking_waveform
    desc: "Single GFP channel"
  single_rfp:
    channels: ["rfp"]
    daq:
      timing: *default_timing
      waveforms:
        camera_1: *camera_waveform
        laser_561: *laser_waveform
        aotf_1: *aotf_blanking_waveform
    desc: "Single RFP channel"
